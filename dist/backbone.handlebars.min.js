// backbone.handlebars v0.1.0
//
// Copyright (c) 2013 Lo√Øc Frering <loic.frering@gmail.com>
// Distributed under the MIT license
(function(){function n(e,t){if(_.isFunction(e)){t(e);return}if(_.isString(e)){if(window[e]){t(window[e]);return}if(typeof require!="undefined"){require([e],t);return}}throw new Error('Cannot resolve view "'+e+'"')}var e=Handlebars.JavaScriptCompiler.prototype.nameLookup;Handlebars.JavaScriptCompiler.prototype.nameLookup=function(t,n,r){return t+".get ? "+t+".get('"+n+"') : "+e.apply(this,arguments)};var t=Backbone.View.extend({render:function(){var e=this.context();_.isString(this.template)&&(this.template=Handlebars.compile(this.template,{knownHelpersOnly:!0}));if(_.isFunction(this.template)){var t=this.template(e);this.$el.html(t)}return this},context:function(){return this.model||this.collection||{}}});Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i=0,s="",o,u;t.data&&(o=Handlebars.createFrame(t.data));if(e&&typeof e=="object")if(e instanceof Array||e instanceof Backbone.Collection)for(var a=e.length;i<a;i++)o&&(o.index=i),u=e.at?e.at(i):e[i],s+=n(u,{data:o});else for(var f in e)e.hasOwnProperty(f)&&(o&&(o.key=f),s+=n(e[f],{data:o}),i++);return i===0&&(s=r(this)),s}),uid=1,Handlebars.registerHelper("view",function(e,t){var r,i,s="bbhbs-"+uid++;return n(e,function(e){r=e;var n=$("#"+s);if(n.size()===1){var i=new r(t.hash);n.replaceWith(i.$el),i.render()}}),r?(i=new r(t.hash),i.render(),new Handlebars.SafeString(i.$el[0].outerHTML)):new Handlebars.SafeString('<div id="'+s+'"></div>')}),Backbone.HandlebarsView=t})();